let e,r,t,o,n,i,s,a,l,d,c,g;function p(e,r,t,o){Object.defineProperty(e,r,{get:t,set:o,enumerable:!0,configurable:!0})}var u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},w={},f={},m=u.parcelRequire6c98;null==m&&((m=function(e){if(e in w)return w[e].exports;if(e in f){var r=f[e];delete f[e];var t={id:e,exports:{}};return w[e]=t,r.call(t.exports,t,t.exports),t.exports}var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,r){f[e]=r},u.parcelRequire6c98=m),m.register("27Lyk",function(e,r){p(e.exports,"register",()=>t,e=>t=e),p(e.exports,"resolve",()=>o,e=>o=e);var t,o,n={};t=function(e){for(var r=Object.keys(e),t=0;t<r.length;t++)n[r[t]]=e[r[t]]},o=function(e){var r=n[e];if(null==r)throw Error("Could not resolve bundle with id "+e);return r}}),m("27Lyk").register(JSON.parse('{"gEVFf":"edgeProjection.59721e0c.js","8zbCD":"projectionAsync.worker.28971622.js","dJZsV":"projectionAsync.worker.d112c604.js","6k19S":"silhouetteProjection.4211e9ae.js","8wv4S":"planarIntersection.e9e5f1e5.js"}'));var y=m("ilwiq"),h=m("jiuw3"),b=m("5Rd1x"),x=m("7lx9d"),v=m("7ePFa"),E=m("kp7Te"),j=m("4CEV9"),y=m("ilwiq");const P="ProjectionGeneratorWorker";var k={},M={};M=function(e,r,t){if(r===self.location.origin)return e;var o=t?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([o],{type:"application/javascript"}))};let W=new URL(m("27Lyk").resolve("8zbCD"),import.meta.url);k=M(W.toString(),W.origin,!0);class L{constructor(){this.running=!1,this.worker=new Worker(k),this.worker.onerror=e=>{if(e.message)throw Error(`${P}: Could not create Web Worker with error "${e.message}"`);throw Error(`${P}: Could not create Web Worker.`)}}generate(e,r={}){if(this.running)throw Error(`${P}: Already running job.`);if(null===this.worker)throw Error(`${P}: Worker has been disposed.`);let{worker:t}=this;return this.running=!0,new Promise((o,n)=>{t.onerror=e=>{n(Error(`${P}: ${e.message}`)),this.running=!1},t.onmessage=e=>{this.running=!1;let{data:i}=e;if(i.error)n(Error(i.error)),t.onmessage=null;else if(i.result){let e=new y.BufferGeometry;e.setAttribute("position",new y.BufferAttribute(i.result,3,!1)),o(e),t.onmessage=null}else r.onProgress&&r.onProgress(i.progress)};let i=e.index?e.index.array.slice():null,s=e.attributes.position.array.slice(),a=[s.buffer];i&&a.push(i.buffer),t.postMessage({index:i,position:s,options:{...r,onProgress:null,includedProgressCallback:!!r.onProgress}},a)})}dispose(){this.worker.terminate(),this.worker=null}}var O=m("fNPnQ");const F={displayModel:"color",displayEdges:!1,displayProjection:!0,sortEdges:!0,includeIntersectionEdges:!0,useWorker:!1,rotate:()=>{a.quaternion.random(),a.position.set(0,0,0),a.updateMatrixWorld(!0);let e=new y.Box3;e.setFromObject(i,!0),e.getCenter(a.position).multiplyScalar(-1),a.position.y=Math.max(0,-e.min.y)+1},regenerate:()=>{S=C()}};let S=null;function*C(e=30){c.innerText="processing: --";let r=window.performance.now(),t=[];i.updateWorldMatrix(!0,!0),i.traverse(e=>{if(e.geometry){let r=e.geometry.clone();for(let t in r.applyMatrix4(e.matrixWorld),r.attributes)"position"!==t&&r.deleteAttribute(t);t.push(r)}});let o=(0,v.mergeGeometries)(t,!1),n=window.performance.now()-r;yield,F.includeIntersectionEdges&&(c.innerText="processing: finding edge intersections...",s.geometry.dispose(),s.geometry=new y.BufferGeometry),r=window.performance.now();let a=null;if(F.useWorker)for(g.generate(o,{sortEdges:F.sortEdges,includeIntersectionEdges:F.includeIntersectionEdges,onProgress:e=>{c.innerText=`processing: ${parseFloat((100*e).toFixed(2))}%`}}).then(e=>{a=e});null===a;)yield;else{let r=new j.ProjectionGenerator;r.sortEdges=F.sortEdges,r.iterationTime=e,r.angleThreshold=50,r.includeIntersectionEdges=F.includeIntersectionEdges;let t=r.generate(o,{onProgress:(e,r)=>{c.innerText=`processing: ${parseFloat((100*e).toFixed(2))}%`,F.displayProjection&&(s.geometry.dispose(),s.geometry=r.getLineGeometry())}}),n=t.next();for(;!n.done;)n=t.next(),yield;a=n.value}let l=window.performance.now()-r;s.geometry.dispose(),s.geometry=a,c.innerText=`merge geometry  : ${n.toFixed(2)}ms
edge trimming   : ${l.toFixed(2)}ms`}!async function(){c=document.getElementById("output"),(e=new y.WebGLRenderer({antialias:!0})).setPixelRatio(window.devicePixelRatio),e.setSize(window.innerWidth,window.innerHeight),e.setClearColor(15658734,1),document.body.appendChild(e.domElement),t=new y.Scene;let p=new y.DirectionalLight(16777215,3.5);p.position.set(1,2,3),t.add(p);let u=new y.AmbientLight(11583173,.5);t.add(u),a=new y.Group,t.add(a);let w=await new(0,x.GLTFLoader)().setMeshoptDecoder(E.MeshoptDecoder).loadAsync("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/nasa-m2020/Perseverance.glb");i=w.scene;let f=new y.MeshStandardMaterial({polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1});(l=i.clone()).traverse(e=>{e.material&&(e.material=f)});let m=new y.MeshBasicMaterial({polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1});(d=i.clone()).traverse(e=>{e.material&&(e.material=m)}),a.updateMatrixWorld(!0);let v=new y.Box3;v.setFromObject(i,!0),v.getCenter(a.position).multiplyScalar(-1),a.position.y=Math.max(0,-v.min.y)+1,a.add(i,l,d),n=new y.Group,i.traverse(e=>{if(e.geometry){let r=(0,O.generateEdges)(e.geometry,void 0,50),t=r.flatMap(e=>[e.start,e.end]),o=new y.BufferGeometry;o.setFromPoints(t);let i=new y.LineSegments(o,new y.LineBasicMaterial({color:197379}));i.position.copy(e.position),i.quaternion.copy(e.quaternion),i.scale.copy(e.scale),n.add(i)}}),a.add(n),s=new y.LineSegments(new y.BufferGeometry,new y.LineBasicMaterial({color:197379})),t.add(s),(r=new y.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.01,50)).position.setScalar(3.5),r.updateProjectionMatrix(),new b.OrbitControls(r,e.domElement),(o=new h.GUI).add(F,"displayModel",["none","color","shaded white"]),o.add(F,"displayProjection"),o.add(F,"sortEdges"),o.add(F,"includeIntersectionEdges"),o.add(F,"useWorker"),o.add(F,"rotate"),o.add(F,"regenerate"),g=new L,S=C(),function o(){if(requestAnimationFrame(o),S){let e=S.next();e.done&&(S=null)}i.visible="color"===F.displayModel,l.visible="shaded white"===F.displayModel,d.visible="white"===F.displayModel,n.visible=F.displayEdges,s.visible=F.displayProjection,e.render(t,r)}(),window.addEventListener("resize",function(){r.aspect=window.innerWidth/window.innerHeight,r.updateProjectionMatrix(),e.setSize(window.innerWidth,window.innerHeight)},!1)}();
//# sourceMappingURL=edgeProjection.59721e0c.js.map
