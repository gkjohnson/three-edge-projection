(()=>{let e,t;var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},i={},o=r.parcelRequire6c98;null==o&&((o=function(e){if(e in n)return n[e].exports;if(e in i){var t=i[e];delete i[e];var r={id:e,exports:{}};return n[e]=r,t.call(r.exports,r,r.exports),r.exports}var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){i[e]=t},r.parcelRequire6c98=o),importScripts("./projectionAsync.worker.d112c604.js");var s=(o("e06gU"),o("e06gU"),o("e06gU"));let a=Symbol("SKIP_GENERATION");var s=o("e06gU");function l(e){return(e.index?e.index.count:e.attributes.position.count)/3}function u(e){let t=l(e),r=e.drawRange,n=r.start/3,i=(r.start+r.count)/3,o=Math.max(0,n);return[{offset:Math.floor(o),count:Math.floor(Math.min(t,i)-o)}]}function c(e){if(!e.groups||!e.groups.length)return u(e);let t=[],r=new Set,n=e.drawRange,i=n.start/3,o=(n.start+n.count)/3;for(let t of e.groups){let e=t.start/3,n=(t.start+t.count)/3;r.add(Math.max(i,e)),r.add(Math.min(o,n))}let s=Array.from(r.values()).sort((e,t)=>e-t);for(let e=0;e<s.length-1;e++){let r=s[e],n=s[e+1];t.push({offset:Math.floor(r),count:Math.floor(n-r)})}return t}function d(e,t,r){return r.min.x=t[e],r.min.y=t[e+1],r.min.z=t[e+2],r.max.x=t[e+3],r.max.y=t[e+4],r.max.z=t[e+5],r}function f(e){let t=-1,r=-1/0;for(let n=0;n<3;n++){let i=e[n+3]-e[n];i>r&&(r=i,t=n)}return t}function p(e,t,r){let n,i;for(let o=0;o<3;o++){let s=o+3;n=e[o],i=t[o],r[o]=n<i?n:i,n=e[s],i=t[s],r[s]=n>i?n:i}}function y(e,t,r){for(let n=0;n<3;n++){let i=t[e+2*n],o=t[e+2*n+1],s=i-o,a=i+o;s<r[n]&&(r[n]=s),a>r[n+3]&&(r[n+3]=a)}}function h(e){let t=e[3]-e[0],r=e[4]-e[1],n=e[5]-e[2];return 2*(t*r+r*n+n*t)}function g(e,t,r,n,i=null){let o=1/0,s=1/0,a=1/0,l=-1/0,u=-1/0,c=-1/0,d=1/0,f=1/0,p=1/0,y=-1/0,h=-1/0,g=-1/0,x=null!==i;for(let n=6*t,i=(t+r)*6;n<i;n+=6){let t=e[n+0],r=e[n+1],i=t-r,m=t+r;i<o&&(o=i),m>l&&(l=m),x&&t<d&&(d=t),x&&t>y&&(y=t);let w=e[n+2],B=e[n+3],b=w-B,A=w+B;b<s&&(s=b),A>u&&(u=A),x&&w<f&&(f=w),x&&w>h&&(h=w);let T=e[n+4],M=e[n+5],P=T-M,v=T+M;P<a&&(a=P),v>c&&(c=v),x&&T<p&&(p=T),x&&T>g&&(g=T)}n[0]=o,n[1]=s,n[2]=a,n[3]=l,n[4]=u,n[5]=c,x&&(i[0]=d,i[1]=f,i[2]=p,i[3]=y,i[4]=h,i[5]=g)}let x=(e,t)=>e.candidate-t.candidate,m=Array(32).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),w=new Float32Array(6);class B{constructor(){}}function b(e,t,r,n,i,o){let s=n,a=n+i-1,l=o.pos,u=2*o.axis;for(;;){for(;s<=a&&r[6*s+u]<l;)s++;for(;s<=a&&r[6*a+u]>=l;)a--;if(!(s<a))return s;for(let e=0;e<3;e++){let r=t[3*s+e];t[3*s+e]=t[3*a+e],t[3*a+e]=r}for(let e=0;e<6;e++){let t=r[6*s+e];r[6*s+e]=r[6*a+e],r[6*a+e]=t}s++,a--}}function A(e,t,r,n,i,o){let s=n,a=n+i-1,l=o.pos,u=2*o.axis;for(;;){for(;s<=a&&r[6*s+u]<l;)s++;for(;s<=a&&r[6*a+u]>=l;)a--;if(!(s<a))return s;{let t=e[s];e[s]=e[a],e[a]=t;for(let e=0;e<6;e++){let t=r[6*s+e];r[6*s+e]=r[6*a+e],r[6*a+e]=t}s++,a--}}}var s=(o("e06gU"),o("e06gU"));class T{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let r=1/0,n=-1/0;for(let i=0,o=e.length;i<o;i++){let o=e[i],s=o[t];r=s<r?s:r,n=s>n?s:n}this.min=r,this.max=n}setFromPoints(e,t){let r=1/0,n=-1/0;for(let i=0,o=t.length;i<o;i++){let o=t[i],s=e.dot(o);r=s<r?s:r,n=s>n?s:n}this.min=r,this.max=n}isSeparated(e){return this.min>e.max||e.min>this.max}}T.prototype.setFromBox=function(){let e=new s.Vector3;return function(t,r){let n=r.min,i=r.max,o=1/0,s=-1/0;for(let r=0;r<=1;r++)for(let a=0;a<=1;a++)for(let l=0;l<=1;l++){e.x=n.x*r+i.x*(1-r),e.y=n.y*a+i.y*(1-a),e.z=n.z*l+i.z*(1-l);let u=t.dot(e);o=Math.min(u,o),s=Math.max(u,s)}this.min=o,this.max=s}}(),new T;var s=(o("e06gU"),o("e06gU"));let M=function(){let e=new s.Vector3,t=new s.Vector3,r=new s.Vector3;return function(n,i,o){let s,a;let l=n.start,u=i.start;r.subVectors(l,u),e.subVectors(n.end,n.start),t.subVectors(i.end,i.start);let c=r.dot(t),d=t.dot(e),f=t.dot(t),p=r.dot(e),y=e.dot(e),h=y*f-d*d;s=0!==h?(c*d-p*f)/h:0,a=(c+s*d)/f,o.x=s,o.y=a}}(),P=function(){let e=new s.Vector2,t=new s.Vector3,r=new s.Vector3;return function(n,i,o,s){M(n,i,e);let a=e.x,l=e.y;if(a>=0&&a<=1&&l>=0&&l<=1){n.at(a,o),i.at(l,s);return}if(a>=0&&a<=1){l<0?i.at(0,s):i.at(1,s),n.closestPointToPoint(s,!0,o);return}if(l>=0&&l<=1){a<0?n.at(0,o):n.at(1,o),i.closestPointToPoint(o,!0,s);return}{let e,u;if(e=a<0?n.start:n.end,u=l<0?i.start:i.end,n.closestPointToPoint(u,!0,t),i.closestPointToPoint(e,!0,r),t.distanceToSquared(u)<=r.distanceToSquared(e)){o.copy(t),s.copy(u);return}o.copy(e),s.copy(r);return}}}(),v=function(){let e=new s.Vector3,t=new s.Vector3,r=new s.Plane,n=new s.Line3;return function(i,o){let{radius:s,center:a}=i,{a:l,b:u,c:c}=o;n.start=l,n.end=u;let d=n.closestPointToPoint(a,!0,e);if(d.distanceTo(a)<=s)return!0;n.start=l,n.end=c;let f=n.closestPointToPoint(a,!0,e);if(f.distanceTo(a)<=s)return!0;n.start=u,n.end=c;let p=n.closestPointToPoint(a,!0,e);if(p.distanceTo(a)<=s)return!0;let y=o.getPlane(r),h=Math.abs(y.distanceToPoint(a));if(h<=s){let e=y.projectPoint(a,t),r=o.containsPoint(e);if(r)return!0}return!1}}();function V(e){return 1e-15>Math.abs(e)}class U extends s.Triangle{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=[,,,,].fill().map(()=>new s.Vector3),this.satBounds=[,,,,].fill().map(()=>new T),this.points=[this.a,this.b,this.c],this.sphere=new s.Sphere,this.plane=new s.Plane,this.needsUpdate=!0}intersectsSphere(e){return v(e,this)}update(){let e=this.a,t=this.b,r=this.c,n=this.points,i=this.satAxes,o=this.satBounds,s=i[0],a=o[0];this.getNormal(s),a.setFromPoints(s,n);let l=i[1],u=o[1];l.subVectors(e,t),u.setFromPoints(l,n);let c=i[2],d=o[2];c.subVectors(t,r),d.setFromPoints(c,n);let f=i[3],p=o[3];f.subVectors(r,e),p.setFromPoints(f,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(s,e),this.needsUpdate=!1}}U.prototype.closestPointToSegment=function(){let e=new s.Vector3,t=new s.Vector3,r=new s.Line3;return function(n,i=null,o=null){let s;let{start:a,end:l}=n,u=this.points,c=1/0;for(let a=0;a<3;a++){let l=(a+1)%3;r.start.copy(u[a]),r.end.copy(u[l]),P(r,n,e,t),(s=e.distanceToSquared(t))<c&&(c=s,i&&i.copy(e),o&&o.copy(t))}return this.closestPointToPoint(a,e),(s=a.distanceToSquared(e))<c&&(c=s,i&&i.copy(e),o&&o.copy(a)),this.closestPointToPoint(l,e),(s=l.distanceToSquared(e))<c&&(c=s,i&&i.copy(e),o&&o.copy(l)),Math.sqrt(c)}}(),U.prototype.intersectsTriangle=function(){let e=new U,t=[,,,],r=[,,,],n=new T,i=new T,o=new s.Vector3,a=new s.Vector3,l=new s.Vector3,u=new s.Vector3,c=new s.Vector3,d=new s.Line3,f=new s.Line3,p=new s.Line3,y=new s.Vector3;function h(e,t,r){let n=e.points,i=0,o=-1;for(let e=0;e<3;e++){let{start:s,end:l}=d;s.copy(n[e]),l.copy(n[(e+1)%3]),d.delta(a);let u=V(t.distanceToPoint(s));if(V(t.normal.dot(a))&&u){r.copy(d),i=2;break}let c=t.intersectLine(d,y);if(!c&&u&&y.copy(s),(c||u)&&!V(y.distanceTo(l))){if(i<=1){let e=1===i?r.start:r.end;e.copy(y),u&&(o=i)}else if(i>=2){let e=1===o?r.start:r.end;e.copy(y),i=2;break}if(2==++i&&-1===o)break}}return i}return function(s,a=null,d=!1){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);let y=this.plane,g=s.plane;if(Math.abs(y.normal.dot(g.normal))>1-1e-10){let e=this.satBounds,l=this.satAxes;r[0]=s.a,r[1]=s.b,r[2]=s.c;for(let t=0;t<4;t++){let i=e[t],o=l[t];if(n.setFromPoints(o,r),i.isSeparated(n))return!1}let u=s.satBounds,c=s.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let e=0;e<4;e++){let r=u[e],i=c[e];if(n.setFromPoints(i,t),r.isSeparated(n))return!1}for(let e=0;e<4;e++){let s=l[e];for(let e=0;e<4;e++){let a=c[e];if(o.crossVectors(s,a),n.setFromPoints(o,t),i.setFromPoints(o,r),n.isSeparated(i))return!1}}return a&&(d||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),a.start.set(0,0,0),a.end.set(0,0,0)),!0}{let e=h(this,g,f);if(1===e&&s.containsPoint(f.end))return a&&(a.start.copy(f.end),a.end.copy(f.end)),!0;if(2!==e)return!1;let t=h(s,y,p);if(1===t&&this.containsPoint(p.end))return a&&(a.start.copy(p.end),a.end.copy(p.end)),!0;if(2!==t)return!1;if(f.delta(l),p.delta(u),0>l.dot(u)){let e=p.start;p.start=p.end,p.end=e}let r=f.start.dot(l),n=f.end.dot(l),i=p.start.dot(l),o=p.end.dot(l);return(r===o||i===n||n<i!=r<o)&&(a&&(c.subVectors(f.start,p.start),c.dot(l)>0?a.start.copy(f.start):a.start.copy(p.start),c.subVectors(f.end,p.end),0>c.dot(l)?a.end.copy(f.end):a.end.copy(p.end)),!0)}}}(),U.prototype.distanceToPoint=function(){let e=new s.Vector3;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),U.prototype.distanceToTriangle=function(){let e=new s.Vector3,t=new s.Vector3,r=["a","b","c"],n=new s.Line3,i=new s.Line3;return function(o,s=null,a=null){let l=s||a?n:null;if(this.intersectsTriangle(o,l))return(s||a)&&(s&&l.getCenter(s),a&&l.getCenter(a)),0;let u=1/0;for(let t=0;t<3;t++){let n;let i=r[t],l=o[i];this.closestPointToPoint(l,e),(n=l.distanceToSquared(e))<u&&(u=n,s&&s.copy(e),a&&a.copy(l));let c=this[i];o.closestPointToPoint(c,e),(n=c.distanceToSquared(e))<u&&(u=n,s&&s.copy(c),a&&a.copy(e))}for(let l=0;l<3;l++){let c=r[l],d=r[(l+1)%3];n.set(this[c],this[d]);for(let l=0;l<3;l++){let c=r[l],d=r[(l+1)%3];i.set(o[c],o[d]),P(n,i,e,t);let f=e.distanceToSquared(t);f<u&&(u=f,s&&s.copy(e),a&&a.copy(t))}}return Math.sqrt(u)}}();class S{constructor(e,t,r){this.isOrientedBox=!0,this.min=new s.Vector3,this.max=new s.Vector3,this.matrix=new s.Matrix4,this.invMatrix=new s.Matrix4,this.points=Array(8).fill().map(()=>new s.Vector3),this.satAxes=[,,,].fill().map(()=>new s.Vector3),this.satBounds=[,,,].fill().map(()=>new T),this.alignedSatBounds=[,,,].fill().map(()=>new T),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),r&&this.matrix.copy(r)}set(e,t,r){this.min.copy(e),this.max.copy(t),this.matrix.copy(r),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}S.prototype.update=function(){let e=this.matrix,t=this.min,r=this.max,n=this.points;for(let i=0;i<=1;i++)for(let o=0;o<=1;o++)for(let s=0;s<=1;s++){let a=1*i|2*o|4*s,l=n[a];l.x=i?r.x:t.x,l.y=o?r.y:t.y,l.z=s?r.z:t.z,l.applyMatrix4(e)}let i=this.satBounds,o=this.satAxes,s=n[0];for(let e=0;e<3;e++){let t=o[e],r=i[e],a=1<<e,l=n[a];t.subVectors(s,l),r.setFromPoints(t,n)}let a=this.alignedSatBounds;a[0].setFromPointsField(n,"x"),a[1].setFromPointsField(n,"y"),a[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},S.prototype.intersectsBox=function(){let e=new T;return function(t){this.needsUpdate&&this.update();let r=t.min,n=t.max,i=this.satBounds,o=this.satAxes,s=this.alignedSatBounds;if(e.min=r.x,e.max=n.x,s[0].isSeparated(e)||(e.min=r.y,e.max=n.y,s[1].isSeparated(e))||(e.min=r.z,e.max=n.z,s[2].isSeparated(e)))return!1;for(let r=0;r<3;r++){let n=o[r],s=i[r];if(e.setFromBox(n,t),s.isSeparated(e))return!1}return!0}}(),S.prototype.intersectsTriangle=function(){let e=new U,t=[,,,],r=new T,n=new T,i=new s.Vector3;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(e.copy(o),e.update(),o=e);let s=this.satBounds,a=this.satAxes;t[0]=o.a,t[1]=o.b,t[2]=o.c;for(let e=0;e<3;e++){let n=s[e],i=a[e];if(r.setFromPoints(i,t),n.isSeparated(r))return!1}let l=o.satBounds,u=o.satAxes,c=this.points;for(let e=0;e<3;e++){let t=l[e],n=u[e];if(r.setFromPoints(n,c),t.isSeparated(r))return!1}for(let e=0;e<3;e++){let o=a[e];for(let e=0;e<4;e++){let s=u[e];if(i.crossVectors(o,s),r.setFromPoints(i,t),n.setFromPoints(i,c),r.isSeparated(n))return!1}}return!0}}(),S.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},S.prototype.distanceToPoint=function(){let e=new s.Vector3;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),S.prototype.distanceToBox=function(){let e=["x","y","z"],t=Array(12).fill().map(()=>new s.Line3),r=Array(12).fill().map(()=>new s.Line3),n=new s.Vector3,i=new s.Vector3;return function(o,s=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(a||l)&&(o.getCenter(i),this.closestPointToPoint(i,n),o.closestPointToPoint(n,i),a&&a.copy(n),l&&l.copy(i)),0;let u=s*s,c=o.min,d=o.max,f=this.points,p=1/0;for(let e=0;e<8;e++){let t=f[e];i.copy(t).clamp(c,d);let r=t.distanceToSquared(i);if(r<p&&(p=r,a&&a.copy(t),l&&l.copy(i),r<u))return Math.sqrt(r)}let y=0;for(let n=0;n<3;n++)for(let i=0;i<=1;i++)for(let o=0;o<=1;o++){let s=(n+1)%3,a=(n+2)%3,l=i<<s|o<<a,u=1<<n|i<<s|o<<a,p=f[l],h=f[u],g=t[y];g.set(p,h);let x=e[n],m=e[s],w=e[a],B=r[y],b=B.start,A=B.end;b[x]=c[x],b[m]=i?c[m]:d[m],b[w]=o?c[w]:d[m],A[x]=d[x],A[m]=i?c[m]:d[m],A[w]=o?c[w]:d[m],y++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let r=0;r<=1;r++){i.x=e?d.x:c.x,i.y=t?d.y:c.y,i.z=r?d.z:c.z,this.closestPointToPoint(i,n);let o=i.distanceToSquared(n);if(o<p&&(p=o,a&&a.copy(n),l&&l.copy(i),o<u))return Math.sqrt(o)}for(let e=0;e<12;e++){let o=t[e];for(let e=0;e<12;e++){let t=r[e];P(o,t,n,i);let s=n.distanceToSquared(i);if(s<p&&(p=s,a&&a.copy(n),l&&l.copy(i),s<u))return Math.sqrt(s)}}return Math.sqrt(p)}}();class F{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}let I=new class extends F{constructor(){super(()=>new U)}};var s=o("e06gU");function _(e,t){return 65535===t[e+15]}function z(e,t){return t[e+14]}let L=new class{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;let e=[],t=null;this.setBuffer=r=>{t&&e.push(t),t=r,this.float32Array=new Float32Array(r),this.uint16Array=new Uint16Array(r),this.uint32Array=new Uint32Array(r)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,0!==e.length&&this.setBuffer(e.pop())}}},q=[],E=new F(()=>new s.Box3);var s=o("e06gU");let C=new s.Vector3,R=new s.Vector3;var s=o("e06gU");let X=new s.Vector3,D=new s.Vector3,$=new s.Vector3,O=new s.Vector2,G=new s.Vector2,N=new s.Vector2,H=new s.Vector3,k=new s.Vector3,Y=new s.Vector3,Z=new s.Vector3;function j(e,t,r,n,i){let o=3*n,a=o+0,l=o+1,u=o+2,c=e.index;e.index&&(a=c.getX(a),l=c.getX(l),u=c.getX(u));let{position:d,normal:f,uv:p,uv1:y}=e.attributes,h=function(e,t,r,n,i,o,a,l,u){X.fromBufferAttribute(t,o),D.fromBufferAttribute(t,a),$.fromBufferAttribute(t,l);let c=function(e,t,r,n,i,o){if(null===(o===s.BackSide?e.intersectTriangle(n,r,t,!0,i):e.intersectTriangle(t,r,n,o!==s.DoubleSide,i)))return null;let a=e.origin.distanceTo(i);return{distance:a,point:i.clone()}}(e,X,D,$,Z,u);if(c){n&&(O.fromBufferAttribute(n,o),G.fromBufferAttribute(n,a),N.fromBufferAttribute(n,l),c.uv=(0,s.Triangle).getInterpolation(Z,X,D,$,O,G,N,new s.Vector2)),i&&(O.fromBufferAttribute(i,o),G.fromBufferAttribute(i,a),N.fromBufferAttribute(i,l),c.uv1=(0,s.Triangle).getInterpolation(Z,X,D,$,O,G,N,new s.Vector2)),r&&(H.fromBufferAttribute(r,o),k.fromBufferAttribute(r,a),Y.fromBufferAttribute(r,l),c.normal=(0,s.Triangle).getInterpolation(Z,X,D,$,H,k,Y,new s.Vector3),c.normal.dot(e.direction)>0&&c.normal.multiplyScalar(-1));let t={a:o,b:a,c:l,normal:new s.Vector3,materialIndex:0};(0,s.Triangle).getNormal(X,D,$,t.normal),c.face=t,c.faceIndex=o}return c}(r,d,f,p,y,a,l,u,t);return h?(h.faceIndex=n,i&&i.push(h),h):null}function K(e,t,r,n){let i=e.a,o=e.b,s=e.c,a=t,l=t+1,u=t+2;r&&(a=r.getX(a),l=r.getX(l),u=r.getX(u)),i.x=n.getX(a),i.y=n.getY(a),i.z=n.getZ(a),o.x=n.getX(l),o.y=n.getY(l),o.z=n.getZ(l),s.x=n.getX(u),s.y=n.getY(u),s.z=n.getZ(u)}function J(e,t,r,n,i,o,s){let{geometry:a}=r,{index:l}=a,u=a.attributes.position;for(let r=e,a=t+e;r<a;r++){let e;if(K(s,3*(e=r),l,u),s.needsUpdate=!0,n(s,e,i,o))return!0}return!1}function Q(e,t=null){let r,n,i,o;t&&Array.isArray(t)&&(t=new Set(t));let s=e.geometry,a=s.index?s.index.array:null,l=s.attributes.position,u=0,c=e._roots;for(let e=0,s=c.length;e<s;e++)r=c[e],n=new Uint32Array(r),i=new Uint16Array(r),o=new Float32Array(r),function e(r,s,u=!1){let c=2*r,d=65535===i[c+15];if(d){let e=n[r+6],t=i[c+14],s=1/0,u=1/0,d=1/0,f=-1/0,p=-1/0,y=-1/0;for(let r=3*e,n=3*(e+t);r<n;r++){let e=a[r],t=l.getX(e),n=l.getY(e),i=l.getZ(e);t<s&&(s=t),t>f&&(f=t),n<u&&(u=n),n>p&&(p=n),i<d&&(d=i),i>y&&(y=i)}return(o[r+0]!==s||o[r+1]!==u||o[r+2]!==d||o[r+3]!==f||o[r+4]!==p||o[r+5]!==y)&&(o[r+0]=s,o[r+1]=u,o[r+2]=d,o[r+3]=f,o[r+4]=p,o[r+5]=y,!0)}{let i=r+8,a=n[r+6],l=i+s,c=a+s,d=u,f=!1,p=!1;t?d||(f=t.has(l),p=t.has(c),d=!f&&!p):(f=!0,p=!0);let y=d||f,h=d||p,g=!1;y&&(g=e(i,s,d));let x=!1;h&&(x=e(a,s,d));let m=g||x;if(m)for(let e=0;e<3;e++){let t=i+e,n=a+e,s=o[t],l=o[t+3],u=o[n],c=o[n+3];o[r+e]=s<u?s:u,o[r+e+3]=l>c?l:c}return m}}(0,u),u+=r.byteLength}var s=(o("e06gU"),o("e06gU"),o("e06gU"));let W=new s.Box3;function ee(e,t,r,n){return d(e,t,W),r.intersectBox(W,n)}let et=new s.Vector3;function er(e,t,r,n,i){L.setBuffer(e._roots[t]),function e(t,r,n,i,o){let{float32Array:s,uint16Array:a,uint32Array:l}=L,u=2*t,c=_(u,a);if(c){let e=l[t+6],s=z(u,a);!function(e,t,r,n,i,o){let{geometry:s,_indirectBuffer:a}=e;for(let e=n,a=n+i;e<a;e++)j(s,t,r,e,o)}(r,n,i,e,s,o)}else{let a=t+8;ee(a,s,i,et)&&e(a,r,n,i,o);let u=l[t+6];ee(u,s,i,et)&&e(u,r,n,i,o)}}(0,e,r,n,i),L.clearBuffer()}var s=o("e06gU");let en=new s.Vector3,ei=["x","y","z"];function eo(e,t,r,n){L.setBuffer(e._roots[t]);let i=function e(t,r,n,i){let{float32Array:o,uint16Array:s,uint32Array:a}=L,l=2*t,u=_(l,s);if(u){let e=a[t+6],o=z(l,s);return function(e,t,r,n,i){let{geometry:o,_indirectBuffer:s}=e,a=1/0,l=null;for(let e=n,s=n+i;e<s;e++){let n;(n=j(o,t,r,e))&&n.distance<a&&(l=n,a=n.distance)}return l}(r,n,i,e,o)}{let s,l;let u=a[t+7],c=ei[u],d=i.direction[c],f=d>=0;f?(s=t+8,l=a[t+6]):(s=a[t+6],l=t+8);let p=ee(s,o,i,en),y=p?e(s,r,n,i):null;if(y){let e=y.point[c],t=f?e<=o[l+u]:e>=o[l+u+3];if(t)return y}let h=ee(l,o,i,en),g=h?e(l,r,n,i):null;return y&&g?y.distance<=g.distance?y:g:y||g||null}}(0,e,r,n);return L.clearBuffer(),i}var s=o("e06gU");let es=new s.Box3,ea=new U,el=new U,eu=new s.Matrix4,ec=new S,ed=new S;function ef(e,t,r,n){L.setBuffer(e._roots[t]);let i=function e(t,r,n,i,o=null){let{float32Array:s,uint16Array:a,uint32Array:l}=L,u=2*t;null===o&&(n.boundingBox||n.computeBoundingBox(),ec.set(n.boundingBox.min,n.boundingBox.max,i),o=ec);let c=_(u,a);if(c){let e=r.geometry,o=e.index,c=e.attributes.position,f=n.index,p=n.attributes.position,y=l[t+6],h=z(u,a);if(eu.copy(i).invert(),n.boundsTree){d(t,s,ed),ed.matrix.copy(eu),ed.needsUpdate=!0;let e=n.boundsTree.shapecast({intersectsBounds:e=>ed.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let t=3*y,r=(h+y)*3;t<r;t+=3)if(K(el,t,o,c),el.needsUpdate=!0,e.intersectsTriangle(el))return!0;return!1}});return e}for(let e=3*y,t=(h+y)*3;e<t;e+=3){K(ea,e,o,c),ea.a.applyMatrix4(eu),ea.b.applyMatrix4(eu),ea.c.applyMatrix4(eu),ea.needsUpdate=!0;for(let e=0,t=f.count;e<t;e+=3)if(K(el,e,f,p),el.needsUpdate=!0,ea.intersectsTriangle(el))return!0}}else{let a=t+8,u=l[t+6];d(a,s,es);let c=o.intersectsBox(es)&&e(a,r,n,i,o);if(c)return!0;d(u,s,es);let f=o.intersectsBox(es)&&e(u,r,n,i,o);return!!f}}(0,e,r,n);return L.clearBuffer(),i}var s=o("e06gU");let ep=new s.Matrix4,ey=new S,eh=new S,eg=new s.Vector3,ex=new s.Vector3,em=new s.Vector3,ew=new s.Vector3;function eB(e,t,r,n={},i={},o=0,s=1/0){t.boundingBox||t.computeBoundingBox(),ey.set(t.boundingBox.min,t.boundingBox.max,r),ey.needsUpdate=!0;let a=e.geometry,u=a.attributes.position,c=a.index,d=t.attributes.position,f=t.index,p=I.getPrimitive(),y=I.getPrimitive(),h=null,g=null;i&&(h=em,g=ew);let x=1/0,m=null,w=null;return(ep.copy(r).invert(),eh.matrix.copy(ep),e.shapecast({boundsTraverseOrder:e=>ey.distanceToBox(e),intersectsBounds:(e,t,r)=>r<x&&r<s&&(t&&(eh.min.copy(e.min),eh.max.copy(e.max),eh.needsUpdate=!0),!0),intersectsRange:(e,n)=>{if(t.boundsTree){let i=t.boundsTree;return i.shapecast({boundsTraverseOrder:e=>eh.distanceToBox(e),intersectsBounds:(e,t,r)=>r<x&&r<s,intersectsRange:(t,i)=>{for(let s=t,a=t+i;s<a;s++){K(y,3*s,f,d),y.a.applyMatrix4(r),y.b.applyMatrix4(r),y.c.applyMatrix4(r),y.needsUpdate=!0;for(let t=e,r=e+n;t<r;t++){K(p,3*t,c,u),p.needsUpdate=!0;let e=p.distanceToTriangle(y,eg,h);if(e<x&&(ex.copy(eg),g&&g.copy(h),x=e,m=t,w=s),e<o)return!0}}}})}{let i=l(t);for(let t=0;t<i;t++){K(y,3*t,f,d),y.a.applyMatrix4(r),y.b.applyMatrix4(r),y.c.applyMatrix4(r),y.needsUpdate=!0;for(let r=e,i=e+n;r<i;r++){K(p,3*r,c,u),p.needsUpdate=!0;let e=p.distanceToTriangle(y,eg,h);if(e<x&&(ex.copy(eg),g&&g.copy(h),x=e,m=r,w=t),e<o)return!0}}}}}),I.releasePrimitive(p),I.releasePrimitive(y),x===1/0)?null:(n.point?n.point.copy(ex):n.point=ex.clone(),n.distance=x,n.faceIndex=m,i&&(i.point?i.point.copy(g):i.point=g.clone(),i.point.applyMatrix4(ep),ex.applyMatrix4(ep),i.distance=ex.sub(i.point).length(),i.faceIndex=w),n)}var s=o("e06gU");let eb=new s.Matrix4,eA=new s.Box3,eT=new s.Box3;function eM(e,t,r,n){let{intersectsRanges:i,intersectsTriangles:o}=n,s=e.geometry.index,a=e.geometry.attributes.position,l=t.geometry.index,u=t.geometry.attributes.position;eb.copy(r).invert();let c=I.getPrimitive(),d=I.getPrimitive();if(o){let e=(e,t,n,i,f,p,y,h)=>{for(let g=n,x=n+i;g<x;g++){K(d,3*g,l,u),d.a.applyMatrix4(r),d.b.applyMatrix4(r),d.c.applyMatrix4(r),d.needsUpdate=!0;for(let r=e,n=e+t;r<n;r++)if(K(c,3*r,s,a),c.needsUpdate=!0,o(c,d,r,g,f,p,y,h))return!0}return!1};if(i){let t=i;i=function(r,n,i,o,s,a,l,u){return!!t(r,n,i,o,s,a,l,u)||e(r,n,i,o,s,a,l,u)}}else i=e}t.getBoundingBox(eT),eT.applyMatrix4(r);let f=e.shapecast({intersectsBounds:e=>eT.intersectsBox(e),intersectsRange:(e,r,n,o,s,a)=>(eA.copy(a),eA.applyMatrix4(eb),t.shapecast({intersectsBounds:e=>eA.intersectsBox(e),intersectsRange:(t,n,a,l,u)=>i(e,r,t,n,o,s,l,u)}))});return I.releasePrimitive(c),I.releasePrimitive(d),f}function eP(e,t,r,n,i,o,s){let{geometry:a}=r,{index:l}=a,u=a.attributes.position;for(let a=e,c=t+e;a<c;a++){let e;if(K(s,3*(e=r.resolveTriangleIndex(a)),l,u),s.needsUpdate=!0,n(s,e,i,o))return!0}return!1}function ev(e,t=null){let r,n,i,o;t&&Array.isArray(t)&&(t=new Set(t));let s=e.geometry,a=s.index?s.index.array:null,l=s.attributes.position,u=0,c=e._roots;for(let s=0,d=c.length;s<d;s++)r=c[s],n=new Uint32Array(r),i=new Uint16Array(r),o=new Float32Array(r),function r(s,u,c=!1){let d=2*s,f=65535===i[d+15];if(f){let t=n[s+6],r=i[d+14],u=1/0,c=1/0,f=1/0,p=-1/0,y=-1/0,h=-1/0;for(let n=t,i=t+r;n<i;n++){let t=3*e.resolveTriangleIndex(n);for(let e=0;e<3;e++){let r=t+e;r=a?a[r]:r;let n=l.getX(r),i=l.getY(r),o=l.getZ(r);n<u&&(u=n),n>p&&(p=n),i<c&&(c=i),i>y&&(y=i),o<f&&(f=o),o>h&&(h=o)}}return(o[s+0]!==u||o[s+1]!==c||o[s+2]!==f||o[s+3]!==p||o[s+4]!==y||o[s+5]!==h)&&(o[s+0]=u,o[s+1]=c,o[s+2]=f,o[s+3]=p,o[s+4]=y,o[s+5]=h,!0)}{let e=s+8,i=n[s+6],a=e+u,l=i+u,d=c,f=!1,p=!1;t?d||(f=t.has(a),p=t.has(l),d=!f&&!p):(f=!0,p=!0);let y=d||f,h=d||p,g=!1;y&&(g=r(e,u,d));let x=!1;h&&(x=r(i,u,d));let m=g||x;if(m)for(let t=0;t<3;t++){let r=e+t,n=i+t,a=o[r],l=o[r+3],u=o[n],c=o[n+3];o[s+t]=a<u?a:u,o[s+t+3]=l>c?l:c}return m}}(0,u),u+=r.byteLength}var s=o("e06gU");let eV=new s.Vector3;function eU(e,t,r,n,i){L.setBuffer(e._roots[t]),function e(t,r,n,i,o){let{float32Array:s,uint16Array:a,uint32Array:l}=L,u=2*t,c=_(u,a);if(c){let e=l[t+6],s=z(u,a);!function(e,t,r,n,i,o){let{geometry:s,_indirectBuffer:a}=e;for(let e=n,l=n+i;e<l;e++)j(s,t,r,a?a[e]:e,o)}(r,n,i,e,s,o)}else{let a=t+8;ee(a,s,i,eV)&&e(a,r,n,i,o);let u=l[t+6];ee(u,s,i,eV)&&e(u,r,n,i,o)}}(0,e,r,n,i),L.clearBuffer()}var s=o("e06gU");let eS=new s.Vector3,eF=["x","y","z"];function eI(e,t,r,n){L.setBuffer(e._roots[t]);let i=function e(t,r,n,i){let{float32Array:o,uint16Array:s,uint32Array:a}=L,l=2*t,u=_(l,s);if(u){let e=a[t+6],o=z(l,s);return function(e,t,r,n,i){let{geometry:o,_indirectBuffer:s}=e,a=1/0,l=null;for(let e=n,u=n+i;e<u;e++){let n;(n=j(o,t,r,s?s[e]:e))&&n.distance<a&&(l=n,a=n.distance)}return l}(r,n,i,e,o)}{let s,l;let u=a[t+7],c=eF[u],d=i.direction[c],f=d>=0;f?(s=t+8,l=a[t+6]):(s=a[t+6],l=t+8);let p=ee(s,o,i,eS),y=p?e(s,r,n,i):null;if(y){let e=y.point[c],t=f?e<=o[l+u]:e>=o[l+u+3];if(t)return y}let h=ee(l,o,i,eS),g=h?e(l,r,n,i):null;return y&&g?y.distance<=g.distance?y:g:y||g||null}}(0,e,r,n);return L.clearBuffer(),i}var s=o("e06gU");let e_=new s.Box3,ez=new U,eL=new U,eq=new s.Matrix4,eE=new S,eC=new S;function eR(e,t,r,n){L.setBuffer(e._roots[t]);let i=function e(t,r,n,i,o=null){let{float32Array:s,uint16Array:a,uint32Array:l}=L,u=2*t;null===o&&(n.boundingBox||n.computeBoundingBox(),eE.set(n.boundingBox.min,n.boundingBox.max,i),o=eE);let c=_(u,a);if(c){let e=r.geometry,o=e.index,c=e.attributes.position,f=n.index,p=n.attributes.position,y=l[t+6],h=z(u,a);if(eq.copy(i).invert(),n.boundsTree){d(t,s,eC),eC.matrix.copy(eq),eC.needsUpdate=!0;let e=n.boundsTree.shapecast({intersectsBounds:e=>eC.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let t=y,n=h+y;t<n;t++)if(K(eL,3*r.resolveTriangleIndex(t),o,c),eL.needsUpdate=!0,e.intersectsTriangle(eL))return!0;return!1}});return e}for(let e=y,t=h+y;e<t;e++){let t=r.resolveTriangleIndex(e);K(ez,3*t,o,c),ez.a.applyMatrix4(eq),ez.b.applyMatrix4(eq),ez.c.applyMatrix4(eq),ez.needsUpdate=!0;for(let e=0,t=f.count;e<t;e+=3)if(K(eL,e,f,p),eL.needsUpdate=!0,ez.intersectsTriangle(eL))return!0}}else{let a=t+8,u=l[t+6];d(a,s,e_);let c=o.intersectsBox(e_)&&e(a,r,n,i,o);if(c)return!0;d(u,s,e_);let f=o.intersectsBox(e_)&&e(u,r,n,i,o);return!!f}}(0,e,r,n);return L.clearBuffer(),i}var s=o("e06gU");let eX=new s.Matrix4,eD=new S,e$=new S,eO=new s.Vector3,eG=new s.Vector3,eN=new s.Vector3,eH=new s.Vector3;function ek(e,t,r,n={},i={},o=0,s=1/0){t.boundingBox||t.computeBoundingBox(),eD.set(t.boundingBox.min,t.boundingBox.max,r),eD.needsUpdate=!0;let a=e.geometry,u=a.attributes.position,c=a.index,d=t.attributes.position,f=t.index,p=I.getPrimitive(),y=I.getPrimitive(),h=null,g=null;i&&(h=eN,g=eH);let x=1/0,m=null,w=null;return(eX.copy(r).invert(),e$.matrix.copy(eX),e.shapecast({boundsTraverseOrder:e=>eD.distanceToBox(e),intersectsBounds:(e,t,r)=>r<x&&r<s&&(t&&(e$.min.copy(e.min),e$.max.copy(e.max),e$.needsUpdate=!0),!0),intersectsRange:(n,i)=>{if(t.boundsTree){let a=t.boundsTree;return a.shapecast({boundsTraverseOrder:e=>e$.distanceToBox(e),intersectsBounds:(e,t,r)=>r<x&&r<s,intersectsRange:(t,s)=>{for(let l=t,B=t+s;l<B;l++){let t=a.resolveTriangleIndex(l);K(y,3*t,f,d),y.a.applyMatrix4(r),y.b.applyMatrix4(r),y.c.applyMatrix4(r),y.needsUpdate=!0;for(let t=n,r=n+i;t<r;t++){let r=e.resolveTriangleIndex(t);K(p,3*r,c,u),p.needsUpdate=!0;let n=p.distanceToTriangle(y,eO,h);if(n<x&&(eG.copy(eO),g&&g.copy(h),x=n,m=t,w=l),n<o)return!0}}}})}{let s=l(t);for(let t=0;t<s;t++){K(y,3*t,f,d),y.a.applyMatrix4(r),y.b.applyMatrix4(r),y.c.applyMatrix4(r),y.needsUpdate=!0;for(let r=n,s=n+i;r<s;r++){let n=e.resolveTriangleIndex(r);K(p,3*n,c,u),p.needsUpdate=!0;let i=p.distanceToTriangle(y,eO,h);if(i<x&&(eG.copy(eO),g&&g.copy(h),x=i,m=r,w=t),i<o)return!0}}}}}),I.releasePrimitive(p),I.releasePrimitive(y),x===1/0)?null:(n.point?n.point.copy(eG):n.point=eG.clone(),n.distance=x,n.faceIndex=m,i&&(i.point?i.point.copy(g):i.point=g.clone(),i.point.applyMatrix4(eX),eG.applyMatrix4(eX),i.distance=eG.sub(i.point).length(),i.faceIndex=w),n)}var s=o("e06gU");let eY=new s.Matrix4,eZ=new s.Box3,ej=new s.Box3;function eK(e,t,r,n){let{intersectsRanges:i,intersectsTriangles:o}=n,s=e.geometry.index,a=e.geometry.attributes.position,l=t.geometry.index,u=t.geometry.attributes.position;eY.copy(r).invert();let c=I.getPrimitive(),d=I.getPrimitive();if(o){let n=(n,i,f,p,y,h,g,x)=>{for(let m=f,w=f+p;m<w;m++){let f=t.resolveTriangleIndex(m);K(d,3*f,l,u),d.a.applyMatrix4(r),d.b.applyMatrix4(r),d.c.applyMatrix4(r),d.needsUpdate=!0;for(let t=n,r=n+i;t<r;t++){let r=e.resolveTriangleIndex(t);if(K(c,3*r,s,a),c.needsUpdate=!0,o(c,d,t,m,y,h,g,x))return!0}}return!1};if(i){let e=i;i=function(t,r,i,o,s,a,l,u){return!!e(t,r,i,o,s,a,l,u)||n(t,r,i,o,s,a,l,u)}}else i=n}t.getBoundingBox(ej),ej.applyMatrix4(r);let f=e.shapecast({intersectsBounds:e=>ej.intersectsBox(e),intersectsRange:(e,r,n,o,s,a)=>(eZ.copy(a),eZ.applyMatrix4(eY),t.shapecast({intersectsBounds:e=>eZ.intersectsBox(e),intersectsRange:(t,n,a,l,u)=>i(e,r,t,n,o,s,l,u)}))});return I.releasePrimitive(c),I.releasePrimitive(d),f}let eJ=new S,eQ=new s.Box3;class eW{static serialize(e,t={}){t={cloneBuffers:!0,...t};let r=e.geometry,n=e._roots,i=e._indirectBuffer,o=r.getIndex();return t.cloneBuffers?{roots:n.map(e=>e.slice()),index:o.array.slice(),indirectBuffer:i?i.slice():null}:{roots:n,index:o.array,indirectBuffer:i}}static deserialize(e,t,r={}){r={setIndex:!0,indirect:!!e.indirectBuffer,...r};let{index:n,roots:i,indirectBuffer:o}=e,l=new eW(t,{...r,[a]:!0});if(l._roots=i,l._indirectBuffer=o||null,r.setIndex){let r=t.getIndex();if(null===r){let r=new s.BufferAttribute(e.index,1,!1);t.setIndex(r)}else r.array!==n&&(r.array.set(n),r.needsUpdate=!0)}return l}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw Error("MeshBVH: Only BufferGeometries are supported.");if((t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[a]:!1},t)).useSharedArrayBuffer&&!("undefined"!=typeof SharedArrayBuffer))throw Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[a]||(function(e,t){let r,n,i;let o=e.geometry;t.indirect&&(e._indirectBuffer=function(e,t){let r=(e.index?e.index.count:e.attributes.position.count)/3,n=r>65536,i=n?4:2,o=t?new SharedArrayBuffer(r*i):new ArrayBuffer(r*i),s=n?new Uint32Array(o):new Uint16Array(o);for(let e=0,t=s.length;e<t;e++)s[e]=e;return s}(o,t.useSharedArrayBuffer),function(e){if(0===e.groups.length)return!1;let t=l(e),r=c(e).sort((e,t)=>e.offset-t.offset),n=r[r.length-1];n.count=Math.min(t-n.offset,n.count);let i=0;return r.forEach(({count:e})=>i+=e),t!==i}(o)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),e._indirectBuffer||function(e,t){if(!e.index){let r=e.attributes.position.count,n=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=function(e,t=ArrayBuffer){return e>65535?new Uint32Array(new t(4*e)):new Uint16Array(new t(2*e))}(r,n);e.setIndex(new s.BufferAttribute(i,1));for(let e=0;e<r;e++)i[e]=e}}(o,t);let a=function(e,t){let r=e.geometry,n=r.index?r.index.array:null,i=t.maxDepth,o=t.verbose,s=t.maxLeafTris,a=t.strategy,d=t.onProgress,T=l(r),M=e._indirectBuffer,P=!1,v=new Float32Array(6),V=new Float32Array(6),U=function(e,t){t[0]=t[1]=t[2]=1/0,t[3]=t[4]=t[5]=-1/0;let r=e.attributes.position,n=e.index?e.index.array:null,i=l(e),o=new Float32Array(6*i),s=r.normalized,a=r.array,u=r.offset||0,c=3;r.isInterleavedBufferAttribute&&(c=r.data.stride);let d=["getX","getY","getZ"];for(let e=0;e<i;e++){let i=3*e,l=6*e,f=i+0,p=i+1,y=i+2;n&&(f=n[f],p=n[p],y=n[y]),s||(f=f*c+u,p=p*c+u,y=y*c+u);for(let e=0;e<3;e++){let n,i,u;s?(n=r[d[e]](f),i=r[d[e]](p),u=r[d[e]](y)):(n=a[f+e],i=a[p+e],u=a[y+e]);let c=n;i<c&&(c=i),u<c&&(c=u);let h=n;i>h&&(h=i),u>h&&(h=u);let g=(h-c)/2,x=2*e;o[l+x+0]=c+g,o[l+x+1]=g+(Math.abs(c)+g)*5960464477539063e-23,c<t[e]&&(t[e]=c),h>t[e+3]&&(t[e+3]=h)}}return o}(r,v),S=t.indirect?A:b,F=[],I=t.indirect?u(r):c(r);if(1===I.length){let e=I[0],t=new B;t.boundingData=v,function(e,t,r,n){let i=1/0,o=1/0,s=1/0,a=-1/0,l=-1/0,u=-1/0;for(let n=6*t,c=(t+r)*6;n<c;n+=6){let t=e[n+0];t<i&&(i=t),t>a&&(a=t);let r=e[n+2];r<o&&(o=r),r>l&&(l=r);let c=e[n+4];c<s&&(s=c),c>u&&(u=c)}n[0]=i,n[1]=o,n[2]=s,n[3]=a,n[4]=l,n[5]=u}(U,e.offset,e.count,V),z(t,e.offset,e.count,V),F.push(t)}else for(let e of I){let t=new B;t.boundingData=new Float32Array(6),g(U,e.offset,e.count,t.boundingData,V),z(t,e.offset,e.count,V),F.push(t)}return F;function _(e){d&&d(e/T)}function z(e,t,l,u=null,c=0){if(!P&&c>=i&&(P=!0,o&&(console.warn(`MeshBVH: Max depth of ${i} reached when generating BVH. Consider increasing maxDepth.`),console.warn(r))),l<=s||c>=i)return _(t+l),e.offset=t,e.count=l,e;let d=function(e,t,r,n,i,o){let s=-1,a=0;if(0===o)-1!==(s=f(t))&&(a=(t[s]+t[s+3])/2);else if(1===o)-1!==(s=f(e))&&(a=function(e,t,r,n){let i=0;for(let o=t,s=t+r;o<s;o++)i+=e[6*o+2*n];return i/r}(r,n,i,s));else if(2===o){let o=h(e),l=1.25*i,u=6*n,c=(n+i)*6;for(let e=0;e<3;e++){let n=t[e],d=t[e+3],f=d-n,g=f/32;if(i<8){let t=[...m];t.length=i;let n=0;for(let i=u;i<c;i+=6,n++){let o=t[n];o.candidate=r[i+2*e],o.count=0;let{bounds:s,leftCacheBounds:a,rightCacheBounds:l}=o;for(let e=0;e<3;e++)l[e]=1/0,l[e+3]=-1/0,a[e]=1/0,a[e+3]=-1/0,s[e]=1/0,s[e+3]=-1/0;y(i,r,s)}t.sort(x);let d=i;for(let e=0;e<d;e++){let r=t[e];for(;e+1<d&&t[e+1].candidate===r.candidate;)t.splice(e+1,1),d--}for(let n=u;n<c;n+=6){let i=r[n+2*e];for(let e=0;e<d;e++){let o=t[e];i>=o.candidate?y(n,r,o.rightCacheBounds):(y(n,r,o.leftCacheBounds),o.count++)}}for(let r=0;r<d;r++){let n=t[r],u=n.count,c=i-n.count,d=n.leftCacheBounds,f=n.rightCacheBounds,p=0;0!==u&&(p=h(d)/o);let y=0;0!==c&&(y=h(f)/o);let g=1+1.25*(p*u+y*c);g<l&&(s=e,l=g,a=n.candidate)}}else{for(let e=0;e<32;e++){let t=m[e];t.count=0,t.candidate=n+g+e*g;let r=t.bounds;for(let e=0;e<3;e++)r[e]=1/0,r[e+3]=-1/0}for(let t=u;t<c;t+=6){let i=r[t+2*e],o=i-n,s=~~(o/g);s>=32&&(s=31);let a=m[s];a.count++,y(t,r,a.bounds)}let t=m[31];!function(e,t){t.set(e)}(t.bounds,t.rightCacheBounds);for(let e=30;e>=0;e--){let t=m[e],r=m[e+1];p(t.bounds,r.rightCacheBounds,t.rightCacheBounds)}let d=0;for(let t=0;t<31;t++){let r=m[t],n=r.count,u=r.bounds,c=m[t+1],f=c.rightCacheBounds;0!==n&&(0===d?function(e,t){t.set(e)}(u,w):p(u,w,w));let y=0,g=0;0!==(d+=n)&&(y=h(w)/o);let x=i-d;0!==x&&(g=h(f)/o);let B=1+1.25*(y*d+g*x);B<l&&(s=e,l=B,a=r.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${o} used.`);return{axis:s,pos:a}}(e.boundingData,u,U,t,l,a);if(-1===d.axis)return _(t+l),e.offset=t,e.count=l,e;let b=S(M,n,U,t,l,d);if(b===t||b===t+l)_(t+l),e.offset=t,e.count=l;else{e.splitAxis=d.axis;let r=new B,n=b-t;e.left=r,r.boundingData=new Float32Array(6),g(U,t,n,r.boundingData,V),z(r,t,n,V,c+1);let i=new B,o=l-n;e.right=i,i.boundingData=new Float32Array(6),g(U,b,o,i.boundingData,V),z(i,b,o,V,c+1)}return e}}(e,t),d=[],T=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let e=0;e<a.length;e++){let t=a[e],o=function e(t){return t.count?1:1+e(t.left)+e(t.right)}(t),s=new T(32*o);r=new Float32Array(s),n=new Uint32Array(s),i=new Uint16Array(s),function e(t,o){let s=t/4,a=t/2,l=!!o.count,u=o.boundingData;for(let e=0;e<6;e++)r[s+e]=u[e];if(l){let e=o.offset,r=o.count;return n[s+6]=e,i[a+14]=r,i[a+15]=65535,t+32}{let r;let i=o.left,a=o.right,l=o.splitAxis;if((r=e(t+32,i))/4>4294967296)throw Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[s+6]=r/4,r=e(r,a),n[s+7]=l,r}}(0,t),d.push(s)}e._roots=d}(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new s.Box3)));let{_indirectBuffer:r}=this;this.resolveTriangleIndex=t.indirect?e=>r[e]:e=>e}refit(e=null){let t=this.indirect?ev:Q;return t(this,e)}traverse(e,t=0){let r=this._roots[t],n=new Uint32Array(r),i=new Uint16Array(r);!function t(o,s=0){let a=2*o,l=65535===i[a+15];if(l){let t=n[o+6],u=i[a+14];e(s,l,new Float32Array(r,4*o,6),t,u)}else{let i=o+8,a=n[o+6],u=n[o+7],c=e(s,l,new Float32Array(r,4*o,6),u);c||(t(i,s+1),t(a,s+1))}}(0)}raycast(e,t=s.FrontSide){let r=this._roots,n=this.geometry,i=[],o=t.isMaterial,a=Array.isArray(t),l=n.groups,u=o?t.side:t,c=this.indirect?eU:er;for(let n=0,o=r.length;n<o;n++){let r=a?t[l[n].materialIndex].side:u,o=i.length;if(c(this,n,r,e,i),a){let e=l[n].materialIndex;for(let t=o,r=i.length;t<r;t++)i[t].face.materialIndex=e}}return i}raycastFirst(e,t=s.FrontSide){let r=this._roots,n=this.geometry,i=t.isMaterial,o=Array.isArray(t),a=null,l=n.groups,u=i?t.side:t,c=this.indirect?eI:eo;for(let n=0,i=r.length;n<i;n++){let r=o?t[l[n].materialIndex].side:u,i=c(this,n,r,e);null!=i&&(null==a||i.distance<a.distance)&&(a=i,o&&(i.face.materialIndex=l[n].materialIndex))}return a}intersectsGeometry(e,t){let r=!1,n=this._roots,i=this.indirect?eR:ef;for(let o=0,s=n.length;o<s&&!(r=i(this,o,e,t));o++);return r}shapecast(r){let n=I.getPrimitive(),i=this.indirect?eP:J,{boundsTraverseOrder:o,intersectsBounds:s,intersectsRange:a,intersectsTriangle:l}=r;if(a&&l){let e=a;a=(t,r,o,s,a)=>!!e(t,r,o,s,a)||i(t,r,this,l,o,s,n)}else a||(a=l?(e,t,r,o)=>i(e,t,this,l,r,o,n):(e,t,r)=>r);let u=!1,c=0,f=this._roots;for(let r=0,n=f.length;r<n;r++){let n=f[r];if(u=function(r,n,i,o,s,a){e=E.getPrimitive(),t=E.getPrimitive(),q.push(e,t),L.setBuffer(r._roots[n]);let l=function r(n,i,o,s,a=null,l=0,u=0){let{float32Array:c,uint16Array:f,uint32Array:p}=L,y=2*n,h=_(y,f);if(h){let t=p[n+6],r=z(y,f);return d(n,c,e),s(t,r,!1,u,l+n,e)}{let y,h,m,w,B,b;let A=n+8,T=p[n+6],M=A,P=T;if(a&&(m=e,w=t,d(M,c,m),d(P,c,w),y=a(m),(h=a(w))<y)){M=T,P=A;let e=y;y=h,h=e,m=w}m||d(M,c,m=e);let v=_(2*M,f),V=o(m,v,y,u+1,l+M);if(2===V){let e=g(M),t=x(M),r=t-e;B=s(e,r,!0,u+1,l+M,m)}else B=V&&r(M,i,o,s,a,l,u+1);if(B)return!0;d(P,c,w=t);let U=_(2*P,f),S=o(w,U,h,u+1,l+P);if(2===S){let e=g(P),t=x(P),r=t-e;b=s(e,r,!0,u+1,l+P,w)}else b=S&&r(P,i,o,s,a,l,u+1);if(b)return!0;return!1;function g(e){let{uint16Array:t,uint32Array:r}=L,n=2*e;for(;!_(n,t);)e+=8,n=2*e;return r[e+6]}function x(e){let{uint16Array:t,uint32Array:r}=L,n=2*e;for(;!_(n,t);)n=2*(e=r[e+6]);return r[e+6]+z(n,t)}}}(0,r.geometry,i,o,s,a);L.clearBuffer(),E.releasePrimitive(e),E.releasePrimitive(t),q.pop(),q.pop();let u=q.length;return u>0&&(t=q[u-1],e=q[u-2]),l}(this,r,s,a,o,c))break;c+=n.byteLength}return I.releasePrimitive(n),u}bvhcast(e,t,r){let n=this.indirect?eK:eM;return n(this,e,t,r)}intersectsBox(e,t){return eJ.set(e.min,e.max,t),eJ.needsUpdate=!0,this.shapecast({intersectsBounds:e=>eJ.intersectsBox(e),intersectsTriangle:e=>eJ.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,r={},n={},i=0,o=1/0){let s=this.indirect?ek:eB;return s(this,e,t,r,n,i,o)}closestPointToPoint(e,t={},r=0,n=1/0){return function(e,t,r={},n=0,i=1/0){let o=n*n,s=i*i,a=1/0,l=null;if(e.shapecast({boundsTraverseOrder:e=>(C.copy(t).clamp(e.min,e.max),C.distanceToSquared(t)),intersectsBounds:(e,t,r)=>r<a&&r<s,intersectsTriangle:(e,r)=>{e.closestPointToPoint(t,C);let n=t.distanceToSquared(C);return n<a&&(R.copy(C),a=n,l=r),n<o}}),a===1/0)return null;let u=Math.sqrt(a);return r.point?r.point.copy(R):r.point=R.clone(),r.distance=u,r.faceIndex=l,r}(this,e,t,r,n)}getBoundingBox(e){e.makeEmpty();let t=this._roots;return t.forEach(t=>{d(0,new Float32Array(t),eQ),e.union(eQ)}),e}}var s=o("e06gU");let e0=new s.Vector3(0,1,0),e1=new s.Vector3;function e3(e){return e.needsUpdate&&e.update(),1e-16>=Math.abs(e.plane.normal.dot(e0))}function e2(e,t){let{start:r,end:n}=t,i=e.points,o=!1,s=!1;for(let e=0;e<3;e++){let t=i[e];if(!o&&1e-16>=r.distanceToSquared(t)&&(o=!0),!s&&1e-16>=n.distanceToSquared(t)&&(s=!0),o&&s)return!0}return o&&s}var s=o("e06gU");let e6=new s.Vector3(0,1,0),e4=new s.Vector3,e5=new s.Vector3,e9=new s.Vector3,e8=new s.Triangle;var s=o("e06gU");let e7=new s.Line3;function te(e){e.sort((e,t)=>e[0]-t[0]);for(let t=1;t<e.length;t++){let r=e[t],n=e[t-1];n[1]>=r[0]&&(n[1]=Math.max(n[1],r[1]),e.splice(t,1),t--)}}var s=o("e06gU");let tt=new s.Vector3(0,1,0),tr=new s.Plane,tn=new s.Vector3,ti=new s.Vector3;var s=o("e06gU");let to=new s.Plane,ts=new s.Line3,ta=new s.Vector3,tl=new s.Vector3,tu=new U,tc=new s.Line3,td=new s.Line3,tf=new s.Vector3,tp=new s.Vector3;var s=o("e06gU");let ty=new s.Vector3,th=new s.Vector3,tg=new s.Vector3;var s=o("e06gU");let tx=new U,tm=new s.Line3,tw=new s.Vector3(0,1,0),tB=new s.Line3,tb=new s.Ray,tA=new s.Vector3,tT=new s.Line3;class tM{constructor(){this.edges=[]}getLineGeometry(e=0){let t=this.edges,r=new Float32Array(6*t.length),n=0;for(let i=0,o=t.length;i<o;i++){let o=t[i];r[n++]=o[0],r[n++]=e,r[n++]=o[2],r[n++]=o[3],r[n++]=e,r[n++]=o[5]}let i=new s.BufferGeometry,o=new s.BufferAttribute(r,3,!0);return i.setAttribute("position",o),i}}class tP{constructor(){this.sortEdges=!0,this.iterationTime=30,this.angleThreshold=50,this.includeIntersectionEdges=!0}generateAsync(e,t={}){return new Promise((r,n)=>{let{signal:i}=t,o=this.generate(e,t);!function e(){if(i&&i.aborted){n(Error("ProjectionGenerator: Process aborted via AbortSignal."));return}let t=o.next();t.done?r(t.value):requestAnimationFrame(e)}()})}*generate(e,t={}){let{onProgress:r}=t,{sortEdges:n,iterationTime:i,angleThreshold:o,includeIntersectionEdges:a}=this;e instanceof s.BufferGeometry&&(e=new eW(e,{maxLeafTris:1}));let l=e.geometry,u=function(e,t=e6,r=1){let n=[],i=Math.cos(s.MathUtils.DEG2RAD*r),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,u=[0,0,0],c=["a","b","c"],d=[,,,],f={};for(let e=0;e<l;e+=3){o?(u[0]=o.getX(e),u[1]=o.getX(e+1),u[2]=o.getX(e+2)):(u[0]=e,u[1]=e+1,u[2]=e+2);let{a:r,b:l,c:p}=e8;if(r.fromBufferAttribute(a,u[0]),l.fromBufferAttribute(a,u[1]),p.fromBufferAttribute(a,u[2]),e8.getNormal(e9),d[0]=`${Math.round(1e4*r.x)},${Math.round(1e4*r.y)},${Math.round(1e4*r.z)}`,d[1]=`${Math.round(1e4*l.x)},${Math.round(1e4*l.y)},${Math.round(1e4*l.z)}`,d[2]=`${Math.round(1e4*p.x)},${Math.round(1e4*p.y)},${Math.round(1e4*p.z)}`,d[0]!==d[1]&&d[1]!==d[2]&&d[2]!==d[0])for(let e=0;e<3;e++){let r=(e+1)%3,o=d[e],a=d[r],l=e8[c[e]],p=e8[c[r]],y=`${o}_${a}`,h=`${a}_${o}`;if(h in f&&f[h]){let e=f[h].normal,r=e9.dot(e)<=i,o=t.dot(e9);o=1e-16>Math.abs(o)?0:o;let a=t.dot(e);a=1e-16>Math.abs(a)?0:a;let u=Math.sign(o)!==Math.sign(a);if(r||u){let e=new s.Line3;e.start.copy(l),e.end.copy(p),n.push(e)}f[h]=null}else y in f||(f[y]={index0:u[e],index1:u[r],normal:e9.clone()})}}for(let e in f)if(f[e]){let{index0:t,index1:r}=f[e];e4.fromBufferAttribute(a,t),e5.fromBufferAttribute(a,r);let i=new s.Line3;i.start.copy(e4),i.end.copy(e5),n.push(i)}return n}(l,tw,o);if(a){let t=yield*function*(e,t=30){let r=[],n=e.geometry,i=n.index,o=n.attributes.position,s=i?i.count:o,a=performance.now();for(let n=0;n<s;n+=3){let s=n+0,l=n+1,u=n+2;i&&(s=i.getX(s),l=i.getX(l),u=i.getX(u));let{a:c,b:d,c:f}=tx;c.fromBufferAttribute(o,s),d.fromBufferAttribute(o,l),f.fromBufferAttribute(o,u),tx.needsUpdate=!0,tx.update(),e.shapecast({intersectsBounds:e=>e.intersectsTriangle(tx),intersectsTriangle:e=>!tx.equals(e)&&(e.needsUpdate&&e.update(),!(Math.abs(tx.plane.normal.dot(e.plane.normal))>1-1e-6)&&void(!tx.intersectsTriangle(e,tm,!0)||e2(tx,tm)||e2(e,tm)||(tm.start.y+=1e-6,tm.end.y+=1e-6,r.push(tm.clone()))))});let p=performance.now()-a;p>t&&(yield,a=performance.now())}return r}(e,i);u=u.concat(t)}n&&u.sort((e,t)=>Math.min(e.start.y,e.end.y)-Math.min(t.start.y,t.end.y)),yield;let c=new tM,d=performance.now();for(let t=0,n=u.length;t<n;t++){let n=u[t];if(n.delta(e1).normalize(),Math.abs(e1.dot(e0))>=.9999999999999999)continue;let o=Math.min(n.start.y,n.end.y),a=Math.max(n.start.y,n.end.y),l=[];e.shapecast({intersectsBounds:e=>{e.min.y=Math.min(o-1e-6,e.min.y);let{origin:t,direction:r}=tb;return t.copy(n.start),n.delta(r).normalize(),!!e.containsPoint(t)||!!tb.intersectBox(e,tA)&&t.distanceToSquared(tA)<n.distanceSq()},intersectsTriangle:e=>{let t=Math.max(e.a.y,e.b.y,e.c.y);if(t<=o||e3(e)||e2(e,n))return!1;let r=Math.min(e.a.y,e.b.y,e.c.y);if(a<r)tB.copy(n);else if(!function(e,t,r){if(e3(e))return!1;e.needsUpdate&&e.update(),tr.copy(e.plane),0>tr.normal.dot(tt)&&(tr.normal.multiplyScalar(-1),tr.constant*=-1);let n=tr.distanceToPoint(t.start),i=tr.distanceToPoint(t.end),o=1e-16>Math.abs(n),s=n<0,a=i<0;if(t.delta(ti).normalize(),1e-16>Math.abs(tr.normal.dot(ti)))return!o&&!!s&&(r.copy(t),!0);if(s&&a)return r.copy(t),!0;{if(!s&&!a)return!1;let e=tr.intersectLine(t,tn);if(!e&&(o&&(tn.copy(t.start),e=!0),1e-16>Math.abs(i)&&(tn.copy(t.end),e=!0)),e){if(s)return r.start.copy(t.start),r.end.copy(tn),!0;if(a)return r.end.copy(t.end),r.start.copy(tn),!0}}return!1}(e,n,tB))return!1;if(1e-10>tB.distance())return!1;if(function(e,t,r=new s.Line3){if(tu.copy(t),tu.a.y=0,tu.b.y=0,tu.c.y=0,tu.update(),tc.copy(e),tc.start.y=0,tc.end.y=0,1e-16>=tu.getArea())return null;tc.delta(tf).normalize(),tf.cross(tu.plane.normal).normalize(),to.setFromNormalAndCoplanarPoint(tf,tc.start);let n=0,{points:i}=tu;for(let e=0;e<3;e++){let t=i[e],r=i[(e+1)%3];ts.start.copy(t),ts.end.copy(r);let o=1e-16>Math.abs(to.distanceToPoint(ts.start)),s=1e-16>Math.abs(to.distanceToPoint(ts.end)),a=to.intersectLine(ts,ta);if((a&&!s||o)&&(o&&!a&&ta.copy(ts.start),0===n?td.start.copy(ta):td.end.copy(ta),2==++n))break}if(2===n){if(tc.delta(tf).normalize(),td.delta(tp).normalize(),0>tf.dot(tp)){let e=td.start;td.start=td.end,td.end=e}let t=tl.subVectors(tc.end,tc.start).dot(tf),n=tl.subVectors(td.start,tc.start).dot(tf),i=tl.subVectors(td.end,tc.start).dot(tf);return t<=n||i<=0?null:(e.at(Math.max(0,n)/tc.distance(),r.start),e.at(Math.min(t,i)/tc.distance(),r.end),r)}return null}(tB,e,tT)&&function(e,t,r){e.delta(ty),th.subVectors(t.start,e.start),tg.subVectors(t.end,e.start);let n=ty.length(),i=th.length()/n,o=tg.length()/n;return!(1e-16>=Math.abs((i=Math.min(Math.max(i,0),1))-(o=Math.min(Math.max(o,0),1))))&&(r.push(new Float32Array([i,o])),!0)}(n,tT,l)&&te(l),0!==l.length){let[e,t]=l[l.length-1];return 0===e&&1===t}return!1}}),function(e,t,r=[]){te(t);let n=[[0,1]];for(let e=0,r=t.length;e<r;e++){let r=n[e],i=t[e];r[1]=i[0],n.push(new Float32Array([i[1],1]))}for(let t=0,i=n.length;t<i;t++){let{start:i,end:o}=e;e7.start.lerpVectors(i,o,n[t][0]),e7.end.lerpVectors(i,o,n[t][1]),r.push(new Float32Array([e7.start.x,e7.start.y,e7.start.z,e7.end.x,e7.end.y,e7.end.z]))}}(n,l,c.edges);let f=performance.now()-d;if(f>i){if(r){let e=t/u.length;r(e,c)}yield,d=performance.now()}}return c.getLineGeometry(0)}}onmessage=function({data:e}){let t=performance.now();try{let{index:r,position:n,options:i}=e,o=new s.BufferGeometry;o.setIndex(new s.BufferAttribute(r,1,!1)),o.setAttribute("position",new s.BufferAttribute(n,3,!1));let a=new tP;a.sortEdges=i.sortEdges??a.sortEdges,a.angleThreshold=i.angleThreshold??a.angleThreshold,a.includeIntersectionEdges=i.includeIntersectionEdges??a.includeIntersectionEdges;let l=a.generate(o,{onProgress:function(e){let r=performance.now();(r-t>=10||1===e)&&(postMessage({error:null,progress:e}),t=r)}}),u=l.next();for(;!u.done;)u=l.next();let c=u.value.attributes.position.array;postMessage({result:c,error:null,progress:1},[c.buffer])}catch(e){postMessage({error:e,progress:1})}}})();
//# sourceMappingURL=projectionAsync.worker.28971622.js.map
