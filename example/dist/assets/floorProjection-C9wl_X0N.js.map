{"version":3,"file":"floorProjection-C9wl_X0N.js","sources":["../../../node_modules/three/examples/jsm/controls/MapControls.js","../../floorProjection.js"],"sourcesContent":["import { MOUSE, TOUCH, Plane, Raycaster, Vector2, Vector3 } from 'three';\n\nimport { OrbitControls } from './OrbitControls.js';\n\nconst _plane = new Plane();\nconst _raycaster = new Raycaster();\nconst _mouse = new Vector2();\nconst _panCurrent = new Vector3();\n\n/**\n * This class is intended for transforming a camera over a map from bird's eye perspective.\n * The class shares its implementation with {@link OrbitControls} but uses a specific preset\n * for mouse/touch interaction and disables screen space panning by default.\n *\n * - Orbit: Right mouse, or left mouse + ctrl/meta/shiftKey / touch: two-finger rotate.\n * - Zoom: Middle mouse, or mousewheel / touch: two-finger spread or squish.\n * - Pan: Left mouse, or arrow keys / touch: one-finger move.\n *\n * @augments OrbitControls\n * @three_import import { MapControls } from 'three/addons/controls/MapControls.js';\n */\nclass MapControls extends OrbitControls {\n\n\tconstructor( object, domElement ) {\n\n\t\tsuper( object, domElement );\n\n\t\t/**\n\t\t * Overwritten and set to `false` to pan orthogonal to world-space direction `camera.up`.\n\t\t *\n\t\t * @type {boolean}\n\t\t * @default false\n\t\t */\n\t\tthis.screenSpacePanning = false;\n\n\t\t/**\n\t\t * This object contains references to the mouse actions used by the controls.\n\t\t *\n\t\t * ```js\n\t\t * controls.mouseButtons = {\n\t\t * \tLEFT: THREE.MOUSE.PAN,\n\t\t * \tMIDDLE: THREE.MOUSE.DOLLY,\n\t\t * \tRIGHT: THREE.MOUSE.ROTATE\n\t\t * }\n\t\t * ```\n\t\t * @type {Object}\n\t\t */\n\t\tthis.mouseButtons = { LEFT: MOUSE.PAN, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.ROTATE };\n\n\t\t/**\n\t\t * This object contains references to the touch actions used by the controls.\n\t\t *\n\t\t * ```js\n\t\t * controls.mouseButtons = {\n\t\t * \tONE: THREE.TOUCH.PAN,\n\t\t * \tTWO: THREE.TOUCH.DOLLY_ROTATE\n\t\t * }\n\t\t * ```\n\t\t * @type {Object}\n\t\t */\n\t\tthis.touches = { ONE: TOUCH.PAN, TWO: TOUCH.DOLLY_ROTATE };\n\n\t\tthis._panWorldStart = new Vector3();\n\n\t}\n\n\t_handleMouseDownPan( event ) {\n\n\t\tsuper._handleMouseDownPan( event );\n\n\t\tthis._panOffset.set( 0, 0, 0 );\n\n\t\tif ( this.screenSpacePanning === true ) return;\n\n\t\t_plane.setFromNormalAndCoplanarPoint( this.object.up, this.target );\n\n\t\tconst element = this.domElement;\n\t\tconst rect = element.getBoundingClientRect();\n\t\t_mouse.x = ( ( event.clientX - rect.left ) / rect.width ) * 2 - 1;\n\t\t_mouse.y = - ( ( event.clientY - rect.top ) / rect.height ) * 2 + 1;\n\n\t\t_raycaster.setFromCamera( _mouse, this.object );\n\t\t_raycaster.ray.intersectPlane( _plane, this._panWorldStart );\n\n\t}\n\n\t_handleMouseMovePan( event ) {\n\n\t\tif ( this.screenSpacePanning === true ) {\n\n\t\t\tsuper._handleMouseMovePan( event );\n\t\t\treturn;\n\n\t\t}\n\n\t\tconst element = this.domElement;\n\t\tconst rect = element.getBoundingClientRect();\n\t\t_mouse.x = ( ( event.clientX - rect.left ) / rect.width ) * 2 - 1;\n\t\t_mouse.y = - ( ( event.clientY - rect.top ) / rect.height ) * 2 + 1;\n\n\t\t_raycaster.setFromCamera( _mouse, this.object );\n\n\t\tif ( _raycaster.ray.intersectPlane( _plane, _panCurrent ) ) {\n\n\t\t\t_panCurrent.sub( this._panWorldStart );\n\t\t\tthis._panOffset.copy( _panCurrent ).negate();\n\n\t\t\tthis.update();\n\n\t\t}\n\n\t}\n\n}\n\nexport { MapControls };\n","import {\n\tBox3,\n\tWebGLRenderer,\n\tScene,\n\tDirectionalLight,\n\tAmbientLight,\n\tGroup,\n\tBufferGeometry,\n\tLineSegments,\n\tLineBasicMaterial,\n\tPerspectiveCamera,\n\tMeshBasicMaterial,\n\tMesh,\n\tDoubleSide,\n} from 'three';\nimport { MapControls } from 'three/examples/jsm/controls/MapControls.js';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\nimport { mergeGeometries } from 'three/examples/jsm/utils/BufferGeometryUtils.js';\nimport { MeshoptDecoder } from 'three/examples/jsm/libs/meshopt_decoder.module.js';\nimport { ProjectionGenerator, SilhouetteGenerator } from '../src';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\n\nconst ANGLE_THRESHOLD = 50;\nlet renderer, camera, scene, gui, controls;\nlet model, outlines, group, silhouette;\nlet outputContainer;\nlet task = null;\n\nconst params = {\n\tdisplayModel: false,\n\tregenerate: () => {\n\n\t\ttask = updateProjection();\n\n\t},\n};\n\ninit();\n\nasync function init() {\n\n\toutputContainer = document.getElementById( 'output' );\n\n\tconst bgColor = 0x111111;\n\n\t// renderer setup\n\trenderer = new WebGLRenderer( { antialias: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setClearColor( bgColor, 1 );\n\tdocument.body.appendChild( renderer.domElement );\n\n\t// scene setup\n\tscene = new Scene();\n\n\t// lights\n\tconst light = new DirectionalLight( 0xffffff, 3.5 );\n\tlight.position.set( 1, 2, 3 );\n\tscene.add( light );\n\n\tconst ambientLight = new AmbientLight( 0xb0bec5, 0.5 );\n\tscene.add( ambientLight );\n\n\t// load model\n\tgroup = new Group();\n\tscene.add( group );\n\n\tconst gltf = await new GLTFLoader()\n\t\t.setMeshoptDecoder( MeshoptDecoder )\n\t\t.loadAsync( 'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/3d-home-layout/scene.glb' );\n\tmodel = gltf.scene;\n\tgroup.updateMatrixWorld( true );\n\n\t// center model\n\tconst box = new Box3();\n\tbox.setFromObject( model, true );\n\tbox.getCenter( group.position ).multiplyScalar( - 1 );\n\tgroup.position.y = Math.max( 0, - box.min.y ) + 1;\n\tgroup.add( model );\n\tmodel.visible = false;\n\n\t// create projection display mesh\n\tsilhouette = new Mesh( new BufferGeometry(), new MeshBasicMaterial( {\n\t\tcolor: '#eee',\n\t\tpolygonOffset: true,\n\t\tpolygonOffsetFactor: 3,\n\t\tpolygonOffsetUnits: 3,\n\t\tside: DoubleSide,\n\t} ) );\n\toutlines = new LineSegments( new BufferGeometry(), new LineBasicMaterial( { color: 0x030303 } ) );\n\tscene.add( outlines, silhouette );\n\n\t// camera setup\n\tcamera = new PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.01, 50 );\n\tcamera.position.setScalar( 5.5 );\n\tcamera.updateProjectionMatrix();\n\n\t// controls\n\tcontrols = new MapControls( camera, renderer.domElement );\n\tcontrols.zoomToCursor = true;\n\tcontrols.maxPolarAngle = Math.PI / 3;\n\n\ttask = updateProjection();\n\n\tgui = new GUI();\n\tgui.add( params, 'displayModel' );\n\tgui.add( params, 'regenerate' );\n\n\trender();\n\n\twindow.addEventListener( 'resize', function () {\n\n\t\tcamera.aspect = window.innerWidth / window.innerHeight;\n\t\tcamera.updateProjectionMatrix();\n\n\t\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n\t}, false );\n\n}\n\nfunction* updateProjection() {\n\n\toutputContainer.innerText = 'processing: --';\n\tsilhouette.visible = false;\n\toutlines.visible = false;\n\n\t// transform and merge geometries to project into a single model\n\tconst geometries = [];\n\tmodel.updateWorldMatrix( true, true );\n\tmodel.traverse( c => {\n\n\t\tif ( c.geometry ) {\n\n\t\t\tconst clone = c.geometry.clone();\n\t\t\tclone.applyMatrix4( c.matrixWorld );\n\t\t\tfor ( const key in clone.attributes ) {\n\n\t\t\t\tif ( key !== 'position' ) {\n\n\t\t\t\t\tclone.deleteAttribute( key );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tgeometries.push( clone );\n\n\t\t}\n\n\t} );\n\tconst mergedGeometry = mergeGeometries( geometries, false );\n\n\tyield;\n\n\t// generate the silhouette\n\tlet task, result, generator;\n\tgenerator = new SilhouetteGenerator();\n\tgenerator.sortTriangles = true;\n\ttask = generator.generate( mergedGeometry, {\n\n\t\tonProgress: ( p, data ) => {\n\n\t\t\toutputContainer.innerText = `processing: ${ parseFloat( ( p * 100 ).toFixed( 2 ) ) }%`;\n\t\t\tsilhouette.geometry.dispose();\n\t\t\tsilhouette.geometry = data.getGeometry();\n\t\t\tsilhouette.visible = true;\n\n\t\t},\n\n\t} );\n\n\tresult = task.next();\n\twhile ( ! result.done ) {\n\n\t\tresult = task.next();\n\t\tyield;\n\n\t}\n\n\tsilhouette.geometry.dispose();\n\tsilhouette.geometry = result.value;\n\tsilhouette.visible = true;\n\toutputContainer.innerText = 'generating intersection edges...';\n\n\t// generate the edges\n\tgenerator = new ProjectionGenerator();\n\tgenerator.angleThreshold = ANGLE_THRESHOLD;\n\ttask = generator.generate( mergedGeometry, {\n\n\t\tonProgress: ( p, data ) => {\n\n\t\t\toutputContainer.innerText = `processing: ${ parseFloat( ( p * 100 ).toFixed( 2 ) ) }%`;\n\t\t\toutlines.geometry.dispose();\n\t\t\toutlines.geometry = data.getVisibleLineGeometry();\n\t\t\toutlines.visible = true;\n\n\t\t},\n\n\t} );\n\n\tresult = task.next();\n\twhile ( ! result.done ) {\n\n\t\tresult = task.next();\n\t\tyield;\n\n\t}\n\n\toutlines.geometry.dispose();\n\toutlines.geometry = result.value;\n\toutlines.visible = true;\n\toutputContainer.innerText = '';\n\n}\n\n\nfunction render() {\n\n\trequestAnimationFrame( render );\n\n\tif ( task ) {\n\n\t\tconst res = task.next();\n\t\tif ( res.done ) {\n\n\t\t\ttask = null;\n\n\t\t}\n\n\t}\n\n\tmodel.visible = params.displayModel;\n\trenderer.render( scene, camera );\n\n}\n"],"names":["GUI","task"],"mappings":"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","x_google_ignoreList":[0]}