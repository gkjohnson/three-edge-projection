{"version":3,"file":"planarIntersection-q_t14PmB.js","sources":["../../planarIntersection.js"],"sourcesContent":["import {\n\tBox3,\n\tWebGLRenderer,\n\tScene,\n\tDirectionalLight,\n\tAmbientLight,\n\tGroup,\n\tMeshBasicMaterial,\n\tBufferGeometry,\n\tLineSegments,\n\tLineBasicMaterial,\n\tPerspectiveCamera,\n\tMesh,\n\tPlaneGeometry,\n\tDoubleSide,\n} from 'three';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\nimport { mergeGeometries } from 'three/examples/jsm/utils/BufferGeometryUtils.js';\nimport { MeshoptDecoder } from 'three/examples/jsm/libs/meshopt_decoder.module.js';\nimport { PlanarIntersectionGenerator } from '..';\nimport { MeshBVH } from 'three-mesh-bvh';\n\nconst params = {\n\tdisplayModel: true,\n\tplanePosition: 1,\n};\n\nlet renderer, camera, scene, gui, controls, bvh;\nlet model, projection, group, plane;\nlet outputContainer;\n\ninit();\n\nasync function init() {\n\n\toutputContainer = document.getElementById( 'output' );\n\n\tconst bgColor = 0x111111;\n\n\t// renderer setup\n\trenderer = new WebGLRenderer( { antialias: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setClearColor( bgColor, 1 );\n\trenderer.clear();\n\tdocument.body.appendChild( renderer.domElement );\n\n\t// scene setup\n\tscene = new Scene();\n\n\t// lights\n\tconst light = new DirectionalLight( 0xffffff, 3.5 );\n\tlight.position.set( 1, 2, 3 );\n\tscene.add( light );\n\n\tconst ambientLight = new AmbientLight( 0xb0bec5, 0.5 );\n\tscene.add( ambientLight );\n\n\t// load model\n\tgroup = new Group();\n\tscene.add( group );\n\n\tconst gltf = await new GLTFLoader()\n\t\t.setMeshoptDecoder( MeshoptDecoder )\n\t\t.loadAsync( 'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/nasa-m2020/Perseverance.glb' );\n\tmodel = gltf.scene;\n\n\t// generate the merged geometry\n\tconst geometries = [];\n\tmodel.updateWorldMatrix( true, true );\n\tmodel.traverse( c => {\n\n\t\tif ( c.geometry ) {\n\n\t\t\tconst clone = c.geometry.clone();\n\t\t\tclone.applyMatrix4( c.matrixWorld );\n\t\t\tfor ( const key in clone.attributes ) {\n\n\t\t\t\tif ( key !== 'position' ) {\n\n\t\t\t\t\tclone.deleteAttribute( key );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tgeometries.push( clone );\n\n\t\t}\n\n\t} );\n\tconst mergedGeometry = mergeGeometries( geometries, false );\n\tbvh = new MeshBVH( mergedGeometry, { maxLeafSize: 1 } );\n\n\t// center model\n\tconst box = new Box3();\n\tbox.setFromObject( model, true );\n\tbox.getCenter( group.position ).multiplyScalar( - 1 );\n\tgroup.position.y = Math.max( 0, - box.min.y ) + 1;\n\tgroup.add( model );\n\n\t// create plane to display the cut location\n\tplane = new Mesh( new PlaneGeometry( 5, 5 ), new MeshBasicMaterial( { color: 0x333333, transparent: true, opacity: 0.5, side: DoubleSide } ) );\n\tplane.rotation.x = - Math.PI / 2;\n\tgroup.add( plane );\n\n\t// create projection display mesh\n\tprojection = new LineSegments( new BufferGeometry(), new LineBasicMaterial( { color: 0xeeeeee } ) );\n\tprojection.scale.y = 0;\n\tscene.add( projection );\n\n\t// camera setup\n\tcamera = new PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.01, 50 );\n\tcamera.position.setScalar( 3.5 );\n\tcamera.updateProjectionMatrix();\n\n\t// controls\n\tcontrols = new OrbitControls( camera, renderer.domElement );\n\n\tupdateLines();\n\n\tgui = new GUI();\n\tgui.add( params, 'displayModel' );\n\tgui.add( params, 'planePosition', 0, 2.5 ).onChange( () => updateLines() );\n\trender();\n\n\twindow.addEventListener( 'resize', function () {\n\n\t\tcamera.aspect = window.innerWidth / window.innerHeight;\n\t\tcamera.updateProjectionMatrix();\n\n\t\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n\t}, false );\n\n}\n\nfunction updateLines() {\n\n\tprojection.geometry.dispose();\n\n\tconst generator = new PlanarIntersectionGenerator();\n\tgenerator.plane.constant = - params.planePosition;\n\n\tlet start, delta;\n\tstart = performance.now();\n\tprojection.geometry = generator.generate( bvh );\n\tdelta = performance.now() - start;\n\n\toutputContainer.innerText = `${ delta.toFixed( 2 ) }ms`;\n\n}\n\nfunction render() {\n\n\trequestAnimationFrame( render );\n\n\tgroup.visible = params.displayModel;\n\tprojection.visible = params.displayProjection;\n\tplane.position.y = params.planePosition;\n\trenderer.render( scene, camera );\n\n}\n"],"names":["GUI"],"mappings":"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"}